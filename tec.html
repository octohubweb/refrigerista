!DOCTYPE html
html lang=pt-BR
head
    meta charset=UTF-8
    meta name=viewport content=width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no
    
    titleCalculadora Blindada PRO  Ferramenta de Precifica√ß√£otitle
    meta name=description content=Ferramenta profissional para prestadores de servi√ßos precifica√ß√£o, custos e or√ßamentos via IA.
    meta name=theme-color content=#0f172a

    link rel=icon href=dataimagesvg+xml,svg xmlns=%22httpwww.w3.org2000svg%22 viewBox=%220 0 100 100%22text y=%22.9em%22 font-size=%2290%22üõ°Ô∏ètextsvg

    script src=httpscdn.tailwindcss.comscript
    link href=httpsfonts.googleapis.comcss2family=Interwght@400;500;600;700;800;900&display=swap rel=stylesheet
    link rel=stylesheet href=httpscdnjs.cloudflare.comajaxlibsfont-awesome6.4.0cssall.min.css
    script src=httpscdn.jsdelivr.netnpmmarkedmarked.min.jsscript
    
    style
        body { 
            font-family 'Inter', sans-serif; 
            background-color #f1f5f9;  Slate-100 
            -webkit-font-smoothing antialiased;
            -webkit-tap-highlight-color transparent;
        }
        
         Previne zoom em inputs no iOS 
        input, select, textarea { font-size 16px !important; }

         Remove setas dos inputs num√©ricos 
        .input-field-webkit-outer-spin-button, .input-field-webkit-inner-spin-button { -webkit-appearance none; margin 0; }
        .input-field { -moz-appearance textfield; transition all 0.2s ease-in-out; }
        
         Foco suave e profissional 
        .input-fieldfocus { 
            border-color #2563eb;  Blue-600 
            box-shadow 0 0 0 4px rgba(37, 99, 235, 0.1); 
            background-color #ffffff; 
            transform translateY(-1px);
        }

         Anima√ß√£o de Erro (Shake) 
        @keyframes shake {
            0%, 100% { transform translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform translateX(-4px); }
            20%, 40%, 60%, 80% { transform translateX(4px); }
        }
        .shake-animation { animation shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        
         Layout Central 
        .app-wrapper { 
            min-height 100dvh;  Altura din√¢mica mobile 
            display flex; 
            flex-direction column; 
            justify-content center; 
            align-items center; 
            padding 1rem; 
        }

         Acorde√£o de Mensagens 
        .accordion-content { 
            transition max-height 0.3s ease-out, opacity 0.3s ease-out; 
            max-height 0; 
            opacity 0; 
            overflow hidden; 
        }
        .accordion-open .accordion-content { max-height 2000px; opacity 1; }
        .accordion-open .accordion-icon { transform rotate(180deg); }

         Bot√µes de Quantidade 
        .qty-btn { 
            width 36px; height 36px; 
            display flex; align-items center; justify-content center; 
            border-radius 8px; 
            background #f8fafc; color #64748b; 
            cursor pointer; transition all 0.2s; 
            touch-action manipulation;
        }
        .qty-btnactive { background #e2e8f0; transform scale(0.9); }

         Modal  Bottom Sheet 
        .modal-overlay { background-color rgba(15, 23, 42, 0.6); backdrop-filter blur(4px); }
    style
head
body

    div class=app-wrapper
        
        div class=w-full max-w-md bg-white rounded-3xl overflow-hidden border border-slate-200 shadow-2xl relative z-10 flex flex-col
            
            header class=bg-[#0f172a] text-white p-6 pb-10 relative overflow-hidden flex justify-between items-start shrink-0
                div class=absolute top-0 right-0 w-32 h-32 bg-blue-600 rounded-full opacity-10 blur-3xl transform translate-x-10 -translate-y-10 pointer-events-nonediv
                
                div class=z-10
                    div class=flex items-center gap-2 mb-1 opacity-90
                        i class=fa-solid fa-shield-halved text-blue-500 text-xli
                        span class=text-xs font-bold uppercase tracking-widest text-blue-200FERRAMENTAspan
                    div
                    h1 class=text-2xl font-black uppercase tracking-wide text-white leading-tight
                        CALCULADORA brspan class=text-blue-500BLINDADA PROspan
                    h1
                div
                
                button onclick=toggleSettings() class=z-10 text-slate-400 hovertext-white transition-colors p-3 bg-slate-80050 hoverbg-slate-70080 rounded-xl backdrop-blur-sm activescale-95 shadow-lg border border-slate-70050 title=Configura√ß√µes
                    i class=fa-solid fa-gear text-lgi
                button
            header

            div class=relative -mt-6 bg-white rounded-t-[2rem] px-6 pt-8 pb-8 flex-grow shadow-[0_-10px_20px_-5px_rgba(0,0,0,0.1)]
                
                div id=input-section class=space-y-6 transition-all duration-300
                    
                    div class=bg-slate-5080 p-4 rounded-2xl border border-slate-100 space-y-3
                        label class=block text-xs font-bold text-blue-600 uppercase tracking-wide flex items-center gap-2 mb-2
                            i class=fa-solid fa-user-peni Dados do Or√ßamento
                        label
                        
                        input type=text id=nomePrestador placeholder=Seu Nome  Sua Empresa 
                            class=input-field w-full p-3.5 bg-white border border-slate-200 rounded-xl text-sm font-semibold text-slate-700 placeholder-slate-400 focusoutline-none
                        
                        input type=text id=nomeCliente placeholder=Nome do Cliente 
                            class=input-field w-full p-3.5 bg-white border border-slate-200 rounded-xl text-sm font-semibold text-slate-700 placeholder-slate-400 focusoutline-none
                        
                        div class=grid grid-cols-2 gap-3
                            div
                                label class=block text-[10px] font-bold text-slate-400 mb-1 uppercaseData do Servi√ßolabel
                                input type=date id=dataServico 
                                    class=input-field w-full p-3.5 bg-white border border-slate-200 rounded-xl text-sm font-semibold text-slate-700 focusoutline-none text-center
                            div
                            div class=col-span-1
                                label class=block text-[10px] font-bold text-slate-400 mb-1 uppercaseHora Estimadalabel
                                input type=time id=horaServico value=0900
                                    class=input-field w-full p-3.5 bg-white border border-slate-200 rounded-xl text-sm font-semibold text-slate-700 focusoutline-none text-center
                            div
                        div

                        input type=text id=enderecoServico placeholder=Local  Endere√ßo Completo 
                            class=input-field w-full p-3.5 bg-white border border-slate-200 rounded-xl text-sm font-semibold text-slate-700 placeholder-slate-400 focusoutline-none mt-2
                    div

                    div class=space-y-4
                        div class=flex justify-between items-center px-1
                            label class=text-xs font-bold text-slate-500 uppercase tracking-wide
                                i class=fa-solid fa-list-check mr-1i Servi√ßos a Executar
                            label
                        div
                        
                        div id=services-container class=space-y-3
                            div

                        button onclick=adicionarServico() class=w-full py-3 border-2 border-dashed border-slate-300 rounded-xl text-xs font-bold text-slate-500 hoverborder-blue-500 hovertext-blue-600 hoverbg-blue-50 transition-all flex items-center justify-center gap-2 activescale-[0.99]
                            i class=fa-solid fa-circle-plus text-lgi ADICIONAR OUTRO SERVI√áO
                        button

                        div class=relative
                            i class=fa-solid fa-pen absolute top-4 left-4 text-slate-300 text-xsi
                            textarea id=detalhesServico rows=2 placeholder=Observa√ß√µes t√©cnicas (Ex 5¬∫ andar, tubula√ß√£o exposta...) 
                                class=input-field w-full pl-10 p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium text-slate-700 placeholder-slate-400 focusoutline-none resize-nonetextarea
                        div
                    div

                    div class=space-y-4 pt-4 border-t border-slate-100
                        label class=block text-xs font-bold text-slate-500 uppercase tracking-wide ml-1
                            i class=fa-solid fa-box-open mr-1i Custos da Opera√ß√£o
                        label
                        
                        div class=relative group
                            div class=absolute left-4 top-12 -translate-y-12 bg-slate-100 px-2 py-1 rounded text-xs font-bold text-slate-500 border border-slate-200R$div
                            input type=number id=custoPecas placeholder=0,00 
                                class=input-field w-full pl-16 pr-4 py-4 bg-white border border-slate-200 rounded-xl text-lg font-bold text-slate-700 placeholder-slate-300 focusoutline-none 
                                inputmode=decimal
                            span class=absolute right-4 top-12 -translate-y-12 text-xs font-bold text-slate-300 pointer-events-none uppercaseMaterialspan
                        div

                        div class=grid grid-cols-2 gap-4
                            div class=relative
                                i class=fa-solid fa-route absolute left-4 top-12 -translate-y-12 text-slate-400i
                                input type=number id=distanciaKm placeholder=Km Total 
                                    class=input-field w-full pl-10 pr-2 py-3.5 bg-white border border-slate-200 rounded-xl text-sm font-bold text-slate-700 focusoutline-none 
                                    inputmode=numeric
                                p id=custoKmLabel class=text-[10px] text-slate-400 mt-1.5 ml-1 font-mediumRef R$ 0.98kmp
                            div
                            div class=relative
                                i class=fa-regular fa-clock absolute left-4 top-12 -translate-y-12 text-slate-400i
                                input type=number id=tempoHoras placeholder=Hrs Total 
                                    class=input-field w-full pl-10 pr-2 py-3.5 bg-white border border-slate-200 rounded-xl text-sm font-bold text-slate-700 focusoutline-none 
                                    inputmode=decimal
                                p class=text-[10px] text-slate-400 mt-1.5 ml-1 font-mediumPara registrop
                            div
                        div
                    div

                    button onclick=calcularPrecos() class=w-full bg-gradient-to-r from-blue-600 to-blue-700 hoverfrom-blue-700 hoverto-blue-800 text-white font-black py-4 rounded-2xl shadow-lg shadow-blue-60030 transform transition activescale-[0.98] text-lg mt-4 flex items-center justify-center gap-3 group
                        CALCULAR E GERAR PROPOSTA i class=fa-solid fa-arrow-right group-hovertranslate-x-1 transition-transformi
                    button
                div

                div id=results-section class=hidden animate-fade-in-up space-y-6
                    
                    div class=bg-white rounded-2xl p-5 border border-slate-200 shadow-sm
                        div class=flex justify-between items-center mb-4 border-b border-slate-100 pb-3
                            span class=text-xs font-bold text-slate-500 uppercase tracking-wide flex items-center gap-2
                                i class=fa-solid fa-chart-piei Detalhamento de Custos
                            span
                            span class=text-[10px] font-black text-slate-700 bg-slate-100 px-2 py-1 rounded border border-slate-200 id=displayTotalOperacionalTotal R$ 0,00span
                        div
                        div class=grid grid-cols-3 gap-4 text-center
                            div class=flex flex-col items-center
                                div class=w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-500 mb-1i class=fa-solid fa-truck-fast text-xsidiv
                                p class=text-[10px] font-bold text-slate-400 uppercaseLog√≠sticap
                                p class=text-xs font-black text-slate-700 id=displayLogisticaR$ 0,00p
                            div
                            div class=flex flex-col items-center relative
                                div class=absolute left-0 top-2 bottom-2 w-px bg-slate-100div
                                div class=absolute right-0 top-2 bottom-2 w-px bg-slate-100div
                                
                                div class=w-8 h-8 rounded-full bg-green-50 flex items-center justify-center text-green-500 mb-1i class=fa-solid fa-screwdriver-wrench text-xsidiv
                                p class=text-[10px] font-bold text-slate-400 uppercaseM√£o de Obrap
                                p class=text-xs font-black text-slate-700 id=displayMaoObraR$ 0,00p
                            div
                            div class=flex flex-col items-center
                                div class=w-8 h-8 rounded-full bg-orange-50 flex items-center justify-center text-orange-500 mb-1i class=fa-solid fa-box text-xsidiv
                                p class=text-[10px] font-bold text-slate-400 uppercaseMateriaisp
                                p class=text-xs font-black text-slate-700 id=displayMateriaisR$ 0,00p
                            div
                        div
                    div

                    div class=bg-[#0f172a] p-6 rounded-3xl shadow-xl text-white relative overflow-hidden text-center ring-4 ring-slate-50
                        div class=absolute -top-10 -right-10 w-40 h-40 bg-blue-600 rounded-full opacity-20 blur-3xl pointer-events-nonediv
                        
                        div class=relative z-10
                            p class=text-xs font-bold text-blue-300 uppercase mb-3 tracking-widestValor Sugerido ao Clientep
                            p class=text-5xl font-black tracking-tight mb-5 drop-shadow-md id=displayPrecoFinalR$ 0,00p
                            
                            div class=bg-white10 rounded-xl p-3 flex flex-col items-center justify-center gap-1 w-full border border-white10 backdrop-blur-sm
                                span class=text-[10px] text-slate-300 uppercase tracking-wide font-semiboldSeu Ganho Real (M√£o de Obra + Lucro)span
                                span class=font-black text-green-400 text-2xl tracking-tight id=displayLucroLiquidoR$ 0,00span
                            div
                        div
                    div

                    div class=space-y-4
                        h3 class=text-xs font-bold text-slate-400 uppercase tracking-widest text-center divider flex items-center justify-center gap-2 beforecontent-[''] beforeh-px beforew-10 beforebg-slate-200 aftercontent-[''] afterh-px afterw-10 afterbg-slate-200
                            Pr√≥ximos Passos
                        h3
                        
                        button onclick=gerarOrcamentoIA() id=btnJustificativa class=w-full bg-green-600 hoverbg-green-700 activebg-green-800 text-white py-4 rounded-2xl font-bold text-sm shadow-lg shadow-green-60020 transition-all flex items-center justify-center gap-3 activescale-[0.98]
                            i class=fa-brands fa-whatsapp text-2xli 
                            span class=text-left leading-tight
                                span class=block text-[10px] font-normal opacity-80 uppercaseIntelig√™ncia Artificialspan
                                span id=txtBtnWppGERAR MENSAGENS PRONTASspan
                            span
                        button
                    div
                    
                    div id=aiMessageResult class=hidden space-y-3
                        
                        div class=message-accordion bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm id=acc-msg1
                            button onclick=toggleAccordion('acc-msg1') class=w-full p-4 flex justify-between items-center bg-slate-50 hoverbg-white transition-colors
                                div class=flex items-center gap-3
                                    div class=w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-xs1div
                                    span class=text-xs font-bold text-slate-700 uppercase tracking-wideProposta Comercialspan
                                div
                                i class=fa-solid fa-chevron-down text-slate-400 text-xs accordion-icon transition-transform duration-300i
                            button
                            div class=accordion-content border-t border-slate-100 bg-white
                                div class=p-4 pt-2
                                    div id=msgContent1 class=text-sm text-slate-600 whitespace-pre-wrap mb-4 font-medium leading-relaxed bg-slate-50 p-3 rounded-lg border border-slate-100div
                                    button onclick=copiarTexto('msgContent1', this) class=w-full py-3 bg-blue-600 text-white rounded-xl text-xs font-bold hoverbg-blue-700 flex items-center justify-center gap-2 transition-colors activescale-[0.98]
                                        i class=fa-regular fa-copyi COPIAR TEXTO
                                    button
                                div
                            div
                        div

                        div class=message-accordion bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm id=acc-msg2
                            button onclick=toggleAccordion('acc-msg2') class=w-full p-4 flex justify-between items-center bg-slate-50 hoverbg-white transition-colors
                                div class=flex items-center gap-3
                                    div class=w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-xs2div
                                    span class=text-xs font-bold text-slate-700 uppercase tracking-wideCobran√ßa de Sinalspan
                                div
                                i class=fa-solid fa-chevron-down text-slate-400 text-xs accordion-icon transition-transform duration-300i
                            button
                            div class=accordion-content border-t border-slate-100 bg-white
                                div class=p-4 pt-2
                                    div id=msgContent2 class=text-sm text-slate-600 whitespace-pre-wrap mb-4 font-medium leading-relaxed bg-slate-50 p-3 rounded-lg border border-slate-100div
                                    button onclick=copiarTexto('msgContent2', this) class=w-full py-3 bg-orange-600 text-white rounded-xl text-xs font-bold hoverbg-orange-700 flex items-center justify-center gap-2 transition-colors activescale-[0.98]
                                        i class=fa-regular fa-copyi COPIAR TEXTO
                                    button
                                div
                            div
                        div

                        div class=message-accordion bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm id=acc-msg3
                            button onclick=toggleAccordion('acc-msg3') class=w-full p-4 flex justify-between items-center bg-slate-50 hoverbg-white transition-colors
                                div class=flex items-center gap-3
                                    div class=w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 font-bold text-xs3div
                                    span class=text-xs font-bold text-slate-700 uppercase tracking-wideFinaliza√ß√£o  P√≥s-Obraspan
                                div
                                i class=fa-solid fa-chevron-down text-slate-400 text-xs accordion-icon transition-transform duration-300i
                            button
                            div class=accordion-content border-t border-slate-100 bg-white
                                div class=p-4 pt-2
                                    div id=msgContent3 class=text-sm text-slate-600 whitespace-pre-wrap mb-4 font-medium leading-relaxed bg-slate-50 p-3 rounded-lg border border-slate-100div
                                    button onclick=copiarTexto('msgContent3', this) class=w-full py-3 bg-green-600 text-white rounded-xl text-xs font-bold hoverbg-green-700 flex items-center justify-center gap-2 transition-colors activescale-[0.98]
                                        i class=fa-regular fa-copyi COPIAR TEXTO
                                    button
                                div
                            div
                        div
                    div

                    div class=pt-4 border-t border-slate-200
                        button onclick=reiniciar() class=w-full bg-white text-slate-500 border border-slate-200 py-4 rounded-2xl font-bold text-xs hoverbg-slate-50 activebg-slate-100 transition-colors flex items-center justify-center gap-2
                            i class=fa-solid fa-rotate-lefti FAZER NOVO OR√áAMENTO
                        button
                    div

                    div class=bg-slate-100 rounded-xl p-4 mt-4
                        label class=block text-center text-[10px] font-bold text-slate-400 uppercase mb-3 tracking-widerProva Real Vai dar preju√≠zolabel
                        input type=number id=valorPensado oninput=verificarPrejuizo() 
                            class=w-full p-3 text-center border border-slate-200 rounded-xl font-black text-lg text-slate-700 focusoutline-none focusborder-blue-500 transition-colors placeholder-slate-400 bg-white 
                            placeholder=Digite o valor que pensou cobrar...
                        div id=feedbackBox class=hidden mt-3 p-3 rounded-lg text-center text-xs font-bold shadow-sm animate-bounce-shortdiv
                    div
                div
            div
        div
    div

    div id=settingsModal class=fixed inset-0 z-50 hidden transition-opacity duration-300
        div class=modal-overlay absolute inset-0 w-full h-full onclick=toggleSettings()div
        
        div class=absolute inset-0 flex items-end smitems-center justify-center pointer-events-none p-0 smp-4
            div class=w-full max-w-lg bg-white rounded-t-3xl smrounded-3xl p-6 h-[85vh] smh-auto overflow-y-auto pointer-events-auto shadow-2xl transform transition-transform duration-300 translate-y-full flex flex-col id=modalContent
                
                div class=flex justify-between items-center mb-6 border-b border-slate-100 pb-4 flex-shrink-0
                    h2 class=text-lg font-black text-slate-800 uppercase flex items-center gap-2
                        i class=fa-solid fa-sliders text-blue-600i Configura√ß√µes
                    h2
                    button onclick=toggleSettings() class=w-8 h-8 bg-slate-100 rounded-full text-slate-500 hoverbg-slate-200 flex items-center justify-center transition-colors
                        i class=fa-solid fa-xmark text-lgi
                    button
                div

                div class=space-y-6 flex-grow
                    div class=bg-slate-50 p-5 rounded-2xl border border-slate-200
                        h3 class=text-xs font-bold text-slate-500 uppercase mb-4 flex items-center gap-2
                            i class=fa-solid fa-car-side text-blue-500i Ve√≠culo & Log√≠stica
                        h3
                        div class=grid grid-cols-3 gap-2 mb-4
                            button onclick=setVeiculo('utilitario') class=veiculo-btn p-3 rounded-xl border text-xs font-bold text-center hoverbg-white transition-all shadow-sm activescale-95 data-type=utilitario
                                i class=fa-solid fa-truck-pickup block text-2xl mb-2 text-slate-400i Utilit√°rio
                            button
                            button onclick=setVeiculo('hatch') class=veiculo-btn p-3 rounded-xl border border-blue-500 bg-white text-blue-700 text-xs font-bold text-center shadow-sm activescale-95 data-type=hatch
                                i class=fa-solid fa-car block text-2xl mb-2 text-blue-500i Hatch
                            button
                            button onclick=setVeiculo('moto') class=veiculo-btn p-3 rounded-xl border text-xs font-bold text-center hoverbg-white transition-all shadow-sm activescale-95 data-type=moto
                                i class=fa-solid fa-motorcycle block text-2xl mb-2 text-slate-400i Moto
                            button
                        div
                        
                        div class=grid grid-cols-2 gap-3
                            div
                                label class=block text-[10px] font-bold text-slate-400 mb-1 uppercaseGasolina (R$)label
                                input type=number id=configGasolina class=input-field w-full p-3 rounded-xl border border-slate-200 text-sm font-bold text-slate-700 bg-white focusoutline-none focusborder-blue-500 value=6.15
                            div
                            div
                                label class=block text-[10px] font-bold text-slate-400 mb-1 uppercaseCustoKmlabel
                                input type=number id=configManutencao class=input-field w-full p-3 rounded-xl border border-slate-200 text-sm font-bold bg-slate-100 text-slate-500 readonly
                            div
                        div
                    div

                    div class=bg-slate-50 p-5 rounded-2xl border border-slate-200
                        h3 class=text-xs font-bold text-slate-500 uppercase mb-4 flex items-center gap-2
                            i class=fa-solid fa-user-clock text-blue-500i Meta Financeira
                        h3
                        div class=mb-4
                            label class=block text-[10px] font-bold text-slate-400 mb-2 uppercaseSal√°rio Livre Desejadolabel
                            div class=relative
                                span class=absolute left-4 top-12 -translate-y-12 text-slate-400 font-boldR$span
                                input type=number id=configMetaMensal class=input-field w-full pl-10 p-3 rounded-xl border border-slate-200 text-sm font-bold text-slate-700 bg-white focusoutline-none focusborder-blue-500 value=4000
                            div
                        div
                        div class=flex justify-between text-xs text-slate-500 bg-white p-3 rounded-xl border border-slate-200 shadow-sm
                            span class=font-mediumHora T√©cnica Calculadaspan
                            span class=font-black text-blue-600 id=calcHoraTecnicaR$ 0,00hspan
                        div
                    div
                div

                div class=mt-6 pt-6 border-t border-slate-100 flex-shrink-0
                    button onclick=salvarConfiguracoes() class=w-full bg-[#0f172a] text-white font-bold py-4 rounded-2xl hoverbg-black activebg-slate-800 transition-all shadow-lg transform activescale-[0.99]
                        Salvar Altera√ß√µes
                    button
                div
            div
        div
    div

    script
         A CHAVE MESTRA DA API FOI REMOVIDA DAQUI POR SEGURAN√áA E MOVIDA PARA O BACKEND DO VERCEL 

        const DATA_2025 = {
            veiculos {
                utilitario { eficiencia 10.5, custoManutencaoKm 0.35, depreciacaoKm 0.53 },
                hatch      { eficiencia 10.8, custoManutencaoKm 0.16, depreciacaoKm 0.25 },
                moto       { eficiencia 35.0, custoManutencaoKm 0.12, depreciacaoKm 0.08 }
            },
            mei { servico 80.90, horasProdutivas 145 }
        };

         BANCO DE PRE√áOS M√çNIMOS (Sugest√£o) 
        const DB_SERVICOS = [
            { nome Instala√ß√£o de Ar-Condicionado, min 550 },
            { nome Manuten√ß√£o PreventivaLimpeza, min 250 },
            { nome Manuten√ß√£o Corretiva, min 350 },
            { nome Servi√ßo El√©trico (Ponto), min 80 },
            { nome Servi√ßo Hidr√°ulico, min 120 },
            { nome Visita T√©cnica, min 100 },
            { nome Outros, min 0 }
        ];

        let state = {
            veiculoSelecionado 'hatch',
            gasolinaPreco 6.15,
            metaMensal 4000
        };

        window.onload = () = {
            loadState();
            updateUIFromState();
            document.getElementById('dataServico').valueAsDate = new Date();
            adicionarServico();  Adiciona linha inicial
        };

         --- SERVI√áOS --- 
        function adicionarServico() {
            const container = document.getElementById('services-container');
            const index = container.children.length;
            
            const div = document.createElement('div');
            div.className = service-row bg-white p-4 rounded-2xl border border-slate-200 shadow-sm animate-fade-in relative;
            div.innerHTML = `
                div class=mb-3
                    label class=block text-[10px] font-bold text-slate-400 uppercase mb-1 ml-1Selecione o Servi√ßolabel
                    select class=service-select w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold text-slate-700 outline-none focusborder-blue-500 focusbg-white transition-colors onchange=atualizarPrecoSugerido(this)
                        option value= disabled selectedClique para escolher...option
                        ${DB_SERVICOS.map(s = `option value=${s.nome} data-min=${s.min}${s.nome}option`).join('')}
                    select
                div
                
                div class=flex gap-3 items-end
                    div class=flex-grow relative group
                        label class=block text-[10px] font-bold text-slate-400 uppercase mb-1 ml-1Valor a Cobrar (Unit√°rio)label
                        div class=relative
                            span class=absolute left-3 top-12 -translate-y-12 text-slate-400 text-xs font-boldR$span
                            input type=number class=service-price input-field w-full pl-9 p-3 bg-white border border-slate-200 rounded-xl text-sm font-bold text-slate-700 outline-none focusborder-blue-500 focusring-1 ring-blue-500 transition-all placeholder=M√≠nimo...
                        div
                    div
                    
                    div class=w-13
                        label class=block text-[10px] font-bold text-slate-400 uppercase mb-1 ml-1 text-centerQtdlabel
                        div class=flex items-center justify-between bg-slate-50 rounded-xl p-1 border border-slate-200 h-[46px]
                            div onclick=alterarQtd(this, -1) class=qty-btn hoverbg-whitei class=fa-solid fa-minus text-[10px]idiv
                            span class=qty-value w-full text-center text-sm font-bold text-slate-7001span
                            div onclick=alterarQtd(this, 1) class=qty-btn hoverbg-whitei class=fa-solid fa-plus text-[10px]idiv
                        div
                    div
                div
                ${index  0  `button onclick=this.closest('.service-row').remove() class=absolute top-3 right-3 text-slate-300 hovertext-red-400 p-2 transition-colorsi class=fa-solid fa-trash-canibutton`  ''}
            `;
            container.appendChild(div);
        }

        function atualizarPrecoSugerido(select) {
            const option = select.options[select.selectedIndex];
            const minPrice = option.getAttribute('data-min');
            const row = select.closest('.service-row');
            const inputPrice = row.querySelector('.service-price');
            
            if (minPrice  0) {
                inputPrice.placeholder = `Base R$ ${minPrice}`;
                inputPrice.setAttribute('data-fallback', minPrice);
            } else {
                inputPrice.placeholder = 0,00;
                inputPrice.removeAttribute('data-fallback');
            }
             Clear value to encourage using fallback or new input
            inputPrice.value = '';
        }

        function alterarQtd(btn, delta) {
            const span = btn.parentElement.querySelector('.qty-value');
            let qtd = parseInt(span.innerText) + delta;
            if (qtd  1) qtd = 1;
            span.innerText = qtd;
        }

         --- C√ÅLCULOS --- 
        function calcularPrecos() {
            let totalServicos = 0;
            let listaServicosTexto = [];
            let hasService = false;
            
            document.querySelectorAll('.service-row').forEach(row = {
                const select = row.querySelector('.service-select');
                const nome = select.value;
                const inputPrice = row.querySelector('.service-price');
                const qtd = parseInt(row.querySelector('.qty-value').innerText);
                
                let precoUnitario = parseFloat(inputPrice.value);
                if (isNaN(precoUnitario)) {
                    precoUnitario = parseFloat(inputPrice.getAttribute('data-fallback'))  0;
                }

                 Changed condition to allow = 0 so user can set 0 price if desired.
                if (nome && (precoUnitario = 0)) {
                    hasService = true;
                    totalServicos += (precoUnitario  qtd);
                    listaServicosTexto.push(`‚Ä¢ ${qtd}x ${nome} - R$ ${precoUnitario.toFixed(2).replace('.', ',')} un.`);
                }
            });

            if (!hasService) { 
                alert(Adicione pelo menos um servi√ßo.);
                shakeButton(); return; 
            }

            const custoMaterial = parseFloat(document.getElementById('custoPecas').value)  0;
            const km = parseFloat(document.getElementById('distanciaKm').value)  0;
            
            const veiculo = DATA_2025.veiculos[state.veiculoSelecionado];
            const custoCombustivelKm = state.gasolinaPreco  veiculo.eficiencia;
            const custoKmTotal = custoCombustivelKm + veiculo.custoManutencaoKm + veiculo.depreciacaoKm;
            const custoLogistica = km  custoKmTotal;

            const custosExtras = custoMaterial + custoLogistica;
            const precoFinal = totalServicos + custosExtras; 

            renderResultados(precoFinal, totalServicos, custoLogistica, custoMaterial, listaServicosTexto);
        }

        function renderResultados(final, maoObra, custoLogistica, custoMaterial, listaTexto) {
            const fmt = (v) = v.toLocaleString('pt-BR', { style 'currency', currency 'BRL' });

            document.getElementById('displayPrecoFinal').innerText = fmt(final);
            document.getElementById('displayLucroLiquido').innerText = fmt(maoObra);

            document.getElementById('displayTotalOperacional').innerText = `Total ${fmt(maoObra + custoLogistica + custoMaterial)}`;
            document.getElementById('displayLogistica').innerText = fmt(custoLogistica);
            document.getElementById('displayMaoObra').innerText = fmt(maoObra);
            document.getElementById('displayMateriais').innerText = fmt(custoMaterial);

            window.lastCalculation = { 
                final, 
                liquido maoObra, 
                lucro 0, 
                dadosForm {
                    prestador document.getElementById('nomePrestador').value  Prestador,
                    cliente document.getElementById('nomeCliente').value  Cliente,
                    data document.getElementById('dataServico').value,
                    hora document.getElementById('horaServico').value,  Nova V8.3
                    endereco document.getElementById('enderecoServico').value  Local do Servi√ßo,
                    servico listaTexto.join(n), 
                    detalhes document.getElementById('detalhesServico').value  Conforme combinado.
                }
            };

            document.getElementById('input-section').classList.add('hidden');
            document.getElementById('results-section').classList.remove('hidden');
            window.scrollTo({ top 0, behavior 'smooth' });
        }

         --- UI FUNCTIONS --- 
        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            const content = document.getElementById('modalContent');
            
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() = { content.classList.remove('translate-y-full'); }, 10);
            } else {
                content.classList.add('translate-y-full');
                setTimeout(() = { modal.classList.add('hidden'); }, 300);
            }
        }

        function toggleAccordion(id) {
            const element = document.getElementById(id);
            const wasOpen = element.classList.contains('accordion-open');
            
            document.querySelectorAll('.message-accordion').forEach(acc = {
                acc.classList.remove('accordion-open');
                acc.querySelector('.accordion-icon').style.transform = 'rotate(0deg)';
            });

            if (!wasOpen) {
                element.classList.add('accordion-open');
                element.querySelector('.accordion-icon').style.transform = 'rotate(180deg)';
            }
        }

        function setVeiculo(type) {
            state.veiculoSelecionado = type;
            document.querySelectorAll('.veiculo-btn').forEach(btn = {
                const icon = btn.querySelector('i');
                if(btn.dataset.type === type) {
                    btn.classList.add('border-blue-500', 'bg-white', 'text-blue-700', 'shadow-md');
                    btn.classList.remove('border-slate-200', 'text-slate-400');
                    if(icon) { icon.classList.remove('text-slate-400'); icon.classList.add('text-blue-500'); }
                } else {
                    btn.classList.remove('border-blue-500', 'bg-white', 'text-blue-700', 'shadow-md');
                    btn.classList.add('border-slate-200', 'text-slate-400');
                    if(icon) { icon.classList.add('text-slate-400'); icon.classList.remove('text-blue-500'); }
                }
            });
            const vData = DATA_2025.veiculos[type];
            document.getElementById('configManutencao').value = (vData.custoManutencaoKm + vData.depreciacaoKm).toFixed(2);
            updateLabels();
        }

        function salvarConfiguracoes() {
            state.gasolinaPreco = parseFloat(document.getElementById('configGasolina').value);
            state.metaMensal = parseFloat(document.getElementById('configMetaMensal').value);
            localStorage.setItem('calcBlindadaState', JSON.stringify(state));
            toggleSettings();
            updateLabels();
        }

        function loadState() {
            const saved = localStorage.getItem('calcBlindadaState');
            if(saved) { state = { ...state, ...JSON.parse(saved) }; }
        }

        function updateUIFromState() {
            setVeiculo(state.veiculoSelecionado);
            document.getElementById('configGasolina').value = state.gasolinaPreco;
            document.getElementById('configMetaMensal').value = state.metaMensal;
            updateLabels();
        }

        function updateLabels() {
            const vData = DATA_2025.veiculos[state.veiculoSelecionado];
            const custoKm = (state.gasolinaPreco  vData.eficiencia) + vData.custoManutencaoKm + vData.depreciacaoKm;
            document.getElementById('custoKmLabel').innerText = `Ref R$ ${custoKm.toFixed(2)}km`;
            
            const custoMensal = state.metaMensal + DATA_2025.mei.servico;
            const horaTecnica = custoMensal  DATA_2025.mei.horasProdutivas;
            document.getElementById('calcHoraTecnica').innerText = `R$ ${horaTecnica.toFixed(2)}h`;
        }

        function shakeButton() {
            const btn = document.querySelector('#input-section button');
            if(btn) {
                btn.classList.add('shake-animation');
                setTimeout(() = btn.classList.remove('shake-animation'), 500);
            }
        }

        function reiniciar() {
            document.getElementById('input-section').classList.remove('hidden');
            document.getElementById('results-section').classList.add('hidden');
            document.getElementById('services-container').innerHTML = '';
            adicionarServico();
            document.getElementById('valorPensado').value = '';
            document.getElementById('feedbackBox').classList.add('hidden');
            document.getElementById('aiMessageResult').classList.add('hidden');
             Reset acorde√µes
            document.querySelectorAll('.message-accordion').forEach(acc = acc.classList.remove('accordion-open'));
            window.scrollTo({ top 0, behavior 'smooth' });
        }

        function verificarPrejuizo() {
            const val = parseFloat(document.getElementById('valorPensado').value);
            const box = document.getElementById('feedbackBox');
            const liquidoReal = window.lastCalculation.final; 
            if(!val) { box.classList.add('hidden'); return; }
            
            box.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-orange-100', 'text-orange-700', 'bg-white', 'text-slate-700');

            if(val  liquidoReal  0.8) { 
                box.classList.add('bg-red-100', 'text-red-700');
                box.innerHTML = `i class=fa-solid fa-skull-crossbones text-xl block mb-1i CUIDADO! Preju√≠zo prov√°vel.`;
            } else if (val  liquidoReal) { 
                box.classList.add('bg-orange-100', 'text-orange-700');
                box.innerHTML = `i class=fa-solid fa-triangle-exclamation text-xl block mb-1i Margem apertada.`;
            } else {
                box.classList.add('bg-green-100', 'text-green-700');
                box.innerHTML = `i class=fa-solid fa-check-circle text-xl block mb-1i PRE√áO SEGURO! Lucro garantido.`;
            }
        }

         --- INTEGRA√á√ÉO IA SEGURA (CHAMADA PROXY VERCEL) --- 
        const VERCEL_FUNCTION_ENDPOINT = apigenerate;  Endpoint da Edge Function no Vercel

        async function callSecureAPI(prompt) {
            try {
                 Chama o backend Vercel, que √© onde a chave API est√° segura
                const response = await fetch(VERCEL_FUNCTION_ENDPOINT, {
                    method 'POST',
                    headers {'Content-Type' 'applicationjson'},
                    body JSON.stringify({ prompt prompt })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() = ({ error 'Erro de Servidor Desconhecido' }));
                    alert(`Erro na fun√ß√£o backend ${errorData.error  response.statusText}. Verifique a chave API no Vercel.`);
                    return null;
                }

                const data = await response.json();
                 O backend retorna um objeto { message Texto gerado }
                return data.message; 
                
            } catch(e) {
                console.error(Erro de redechamada Vercel, e);
                alert(Erro ao comunicar com o servidor. Verifique a conex√£o.); 
                return null;
            }
        }

        async function gerarOrcamentoIA() {
            const { final, dadosForm } = window.lastCalculation;
            const fmt = (v) = v.toLocaleString('pt-BR', { style 'currency', currency 'BRL' });
            
            const btn = document.getElementById('btnJustificativa');
            const txt = document.getElementById('txtBtnWpp');
            const original = txt.innerText;
            txt.innerText = CRIANDO MENSAGENS...; btn.disabled = true;

            const prompt = `
            Aja como assistente comercial. Crie 3 mensagens de WhatsApp profissionais.
            
            DADOS
            - Prestador ${dadosForm.prestador}
            - Cliente ${dadosForm.cliente}
            - LocalData ${dadosForm.endereco}  ${dadosForm.data} √†s ${dadosForm.hora}
            - Obs ${dadosForm.detalhes}
            
            SERVI√áOS (LISTA)
            ${dadosForm.servico}
            
            TOTAL ${fmt(final)} (Parcelamento dispon√≠vel)

            MENSAGEM 1 (PROPOSTA)
            Apresente o or√ßamento formal. Liste os itens com valores. Destaque a garantia e qualidade. Pergunte se pode agendar.
            
            MENSAGEM 2 (SINALFECHAMENTO)
            Para confirmar o servi√ßo. Pe√ßa um ok ou sinal. Espa√ßo para [CHAVE PIX].
            
            MENSAGEM 3 (FINALIZA√á√ÉO)
            Servi√ßo conclu√≠do. Cobran√ßa do valor restante. Agradecimento.

            REGRAS
            - Separe com ---DIVISAO---.
            - Use negrito do WhatsApp.
            - Use emojis profissionais.
            - N√ÉO use tabelas. Use lista com bullets (‚Ä¢).
            `;

             A chamada foi alterada para usar a fun√ß√£o segura
            const resp = await callSecureAPI(prompt); 
            txt.innerText = original; btn.disabled = false;
            
            if (resp) {
                const partes = resp.split(---DIVISAO---);
                document.getElementById('msgContent1').innerText = partes[0].trim();
                document.getElementById('msgContent2').innerText = partes[1]  partes[1].trim()  Erro msg 2;
                document.getElementById('msgContent3').innerText = partes[2]  partes[2].trim()  Erro msg 3;
                
                document.getElementById('aiMessageResult').classList.remove('hidden');
                document.getElementById('aiMessageResult').scrollIntoView({ behavior 'smooth' });
                toggleAccordion('acc-msg1');
            }
        }

        function copiarTexto(id, btn) {
            const texto = document.getElementById(id).innerText;
            const textarea = document.createElement(textarea);
            textarea.value = texto;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                const org = btn.innerHTML;
                btn.innerHTML = 'i class=fa-solid fa-checki COPIADO!';
                setTimeout(() = btn.innerHTML = org, 2000);
            } catch (err) {
                alert(Erro ao copiar. Tente manualmente.);
            }
            document.body.removeChild(textarea);
        }
    script
body
html